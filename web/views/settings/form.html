<!-- 系统设置页面 -->
<div>
    <!-- 页面标题 - 使用 hx-swap-oob 更新顶部标题 -->
    <div id="page-title" hx-swap-oob="true">系统设置</div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-cog" style="color: var(--warning-color);"></i>
                系统配置
            </h3>
        </div>

        <div class="card-body">
            <!-- 设置表单 -->
            <form hx-post="/settings" hx-target="#settings-form-container" hx-swap="innerHTML" x-data="settingsForm()"
                @submit.prevent="submitForm">

                <div id="settings-form-container">
                    <!-- Tab 导航 -->
                    <div x-data="{ activeTab: 'basic' }">
                        <ul class="uk-tab">
                            <li :class="{ 'uk-active': activeTab === 'basic' }">
                                <a href="#" @click.prevent="activeTab = 'basic'">
                                    <i class="fas fa-info-circle"></i> 基本信息
                                </a>
                            </li>
                            <li :class="{ 'uk-active': activeTab === 'contact' }">
                                <a href="#" @click.prevent="activeTab = 'contact'">
                                    <i class="fas fa-address-book"></i> 联系方式
                                </a>
                            </li>
                            <li :class="{ 'uk-active': activeTab === 'regional' }">
                                <a href="#" @click.prevent="activeTab = 'regional'">
                                    <i class="fas fa-globe"></i> 区域设置
                                </a>
                            </li>
                        </ul>

                        <!-- Tab 内容 -->
                        <div style="padding: 32px 16px;">
                            <!-- 基本信息 Tab -->
                            <div x-show="activeTab === 'basic'" x-transition>
                                <h4 style="font-size: 18px; font-weight: 500; margin-bottom: 24px;">基本信息</h4>

                                <div style="margin-bottom: 24px;">
                                    <label class="uk-form-label">网站名称 <span class="required">*</span></label>
                                    <div class="uk-form-controls uk-inline uk-width-1-1">
                                        <span class="uk-form-icon" uk-icon="icon: pencil"></span>
                                        <input class="uk-input" type="text" name="site_name" placeholder="请输入网站名称"
                                            value="{{.SiteName}}" required>
                                    </div>
                                    <div class="uk-form-help">网站的显示名称</div>
                                </div>

                                <div style="margin-bottom: 24px;">
                                    <label class="uk-form-label">网站描述</label>
                                    <div class="uk-form-controls">
                                        <textarea class="uk-textarea" name="site_description" placeholder="请输入网站描述"
                                            rows="4">{{.SiteDescription}}</textarea>
                                    </div>
                                    <div class="uk-form-help">简要描述网站的用途和功能</div>
                                </div>
                            </div>

                            <!-- 联系方式 Tab -->
                            <div x-show="activeTab === 'contact'" x-transition>
                                <h4 style="font-size: 18px; font-weight: 500; margin-bottom: 24px;">联系方式</h4>

                                <div style="margin-bottom: 24px;">
                                    <label class="uk-form-label">联系邮箱 <span class="required">*</span></label>
                                    <div class="uk-form-controls uk-inline uk-width-1-1">
                                        <span class="uk-form-icon" uk-icon="icon: mail"></span>
                                        <input class="uk-input" type="email" name="contact_email"
                                            placeholder="admin@example.com" value="{{.ContactEmail}}" required>
                                    </div>
                                    <div class="uk-form-help">系统通知和联系邮箱</div>
                                </div>

                                <div style="margin-bottom: 24px;">
                                    <label class="uk-form-label">联系电话</label>
                                    <div class="uk-form-controls uk-inline uk-width-1-1">
                                        <span class="uk-form-icon" uk-icon="icon: receiver"></span>
                                        <input class="uk-input" type="tel" name="contact_phone"
                                            placeholder="400-123-4567" value="{{.ContactPhone}}">
                                    </div>
                                    <div class="uk-form-help">客服或技术支持电话</div>
                                </div>
                            </div>

                            <!-- 区域设置 Tab -->
                            <div x-show="activeTab === 'regional'" x-transition>
                                <h4 style="font-size: 18px; font-weight: 500; margin-bottom: 24px;">区域设置</h4>

                                <div class="form-row">
                                    <div>
                                        <label class="uk-form-label">货币 <span class="required">*</span></label>
                                        <div class="uk-form-controls">
                                            <select class="uk-select" name="currency" required>
                                                <option value="CNY" {{if eq .Currency "CNY" }}selected{{end}}>人民币 (CNY)
                                                </option>
                                                <option value="USD" {{if eq .Currency "USD" }}selected{{end}}>美元 (USD)
                                                </option>
                                                <option value="EUR" {{if eq .Currency "EUR" }}selected{{end}}>欧元 (EUR)
                                                </option>
                                                <option value="GBP" {{if eq .Currency "GBP" }}selected{{end}}>英镑 (GBP)
                                                </option>
                                                <option value="JPY" {{if eq .Currency "JPY" }}selected{{end}}>日元 (JPY)
                                                </option>
                                            </select>
                                        </div>
                                        <div class="uk-form-help">系统使用的默认货币</div>
                                    </div>

                                    <div>
                                        <label class="uk-form-label">时区 <span class="required">*</span></label>
                                        <div class="uk-form-controls">
                                            <select class="uk-select" name="timezone" required>
                                                <option value="Asia/Shanghai" {{if eq .Timezone "Asia/Shanghai"
                                                    }}selected{{end}}>亚洲/上海 (GMT+8)</option>
                                                <option value="Asia/Singapore" {{if eq .Timezone "Asia/Singapore"
                                                    }}selected{{end}}>亚洲/新加坡 (GMT+8)</option>
                                                <option value="Asia/Tokyo" {{if eq .Timezone "Asia/Tokyo"
                                                    }}selected{{end}}>亚洲/东京 (GMT+9)</option>
                                                <option value="America/New_York" {{if eq .Timezone "America/New_York"
                                                    }}selected{{end}}>美国/纽约 (GMT-5)</option>
                                                <option value="Europe/London" {{if eq .Timezone "Europe/London"
                                                    }}selected{{end}}>欧洲/伦敦 (GMT+0)</option>
                                            </select>
                                        </div>
                                        <div class="uk-form-help">系统使用的时区</div>
                                    </div>
                                </div>

                                <div style="margin-bottom: 24px;">
                                    <label class="uk-form-label">语言 <span class="required">*</span></label>
                                    <div class="uk-form-controls">
                                        <select class="uk-select" name="language" required>
                                            <option value="zh-CN" {{if eq .Language "zh-CN" }}selected{{end}}>简体中文
                                            </option>
                                            <option value="zh-TW" {{if eq .Language "zh-TW" }}selected{{end}}>繁体中文
                                            </option>
                                            <option value="en-US" {{if eq .Language "en-US" }}selected{{end}}>English
                                                (US)
                                            </option>
                                            <option value="ja-JP" {{if eq .Language "ja-JP" }}selected{{end}}>日本語
                                            </option>
                                        </select>
                                    </div>
                                    <div class="uk-form-help">系统界面语言</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="uk-flex uk-flex-right"
                        style="gap: 12px; margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-light);">
                        <button type="button" class="uk-button uk-button-default" onclick="location.reload()">
                            <i class="fas fa-undo"></i>
                            <span>重置</span>
                        </button>
                        <button type="submit" class="uk-button uk-button-primary" :disabled="loading">
                            <span x-show="loading" uk-spinner="ratio: 0.5"></span>
                            <i class="fas fa-save" x-show="!loading"></i>
                            <span>保存设置</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 危险操作区域 -->
    <div class="content-card" style="margin-top: 24px;">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-exclamation-triangle" style="color: var(--error-color);"></i>
                危险操作
            </h3>
        </div>
        <div class="card-body">
            <div class="uk-alert-warning" uk-alert>
                <strong>警告：</strong> 以下操作可能会影响系统运行，请谨慎操作。
            </div>

            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="uk-button" style="background: var(--warning-color); color: white;" x-data
                    @click="if(confirm('确定要清除缓存吗？')) { alert('缓存已清除（模拟操作）') }">
                    <i class="fas fa-broom"></i>
                    <span>清除缓存</span>
                </button>

                <button class="uk-button uk-button-danger" x-data
                    @click="if(confirm('确定要重置所有设置吗？此操作不可恢复！')) { alert('设置已重置（模拟操作）') }">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>重置所有设置</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    function settingsForm() {
        return {
            loading: false,

            submitForm(event) {
                this.loading = true;
                // 让 HTMX 处理表单提交
                htmx.trigger(event.target, 'submit');

                // 监听提交完成
                setTimeout(() => {
                    this.loading = false;
                }, 500);
            }
        };
    }
</script>