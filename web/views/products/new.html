<!-- 商品新增页面 -->
<div>
    <!-- 页面标题 -->
    <div id="page-title" hx-swap-oob="true">新增商品</div>

    <!-- 面包屑 -->
    <nav class="breadcrumb" aria-label="breadcrumbs" style="margin-bottom: 1.5rem;">
        <ul>
            <li><a href="/dashboard" hx-get="/dashboard" hx-target="#main-container" hx-swap="innerHTML"
                    hx-push-url="true">首页</a></li>
            <li><a href="/products" hx-get="/products" hx-target="#main-container" hx-swap="innerHTML"
                    hx-push-url="true">商品管理</a></li>
            <li class="is-active"><a href="#" aria-current="page">新增商品</a></li>
        </ul>
    </nav>

    <!-- 表单卡片 -->
    <div class="content-card">
        <!-- 错误提示框 -->
        {{if .Error}}
        <div class="notification is-danger is-light" style="margin-bottom: 1.5rem;">
            <button class="delete" onclick="this.parentElement.remove()"></button>
            <strong><i class="fas fa-exclamation-triangle"></i> 验证错误</strong>
            <p style="margin-top: 0.5rem;">{{.Error}}</p>
        </div>
        {{end}}

        <form hx-post="/products" hx-target="#main-container" hx-swap="innerHTML" x-data="productForm()"
            @submit="submitForm($event)" x-init="
                {{if .FormData}}
                form.name = '{{.FormData.Name}}';
                form.sku = '{{.FormData.SKU}}';
                form.category = '{{.FormData.Category}}';
                form.price = {{.FormData.Price}};
                form.stock = {{.FormData.Stock}};
                form.status = '{{.FormData.Status}}';
                form.description = '{{.FormData.Description}}';
                {{end}}
            ">

            <div class="form-row">
                <!-- 商品名称 -->
                <div class="field">
                    <label class="label">商品名称 <span class="has-text-danger">*</span></label>
                    <div class="control has-icons-left">
                        <input class="input" type="text" name="name" placeholder="请输入商品名称" required x-model="form.name"
                            :class="{'is-danger': errors.name}">
                        <span class="icon is-small is-left">
                            <i class="fas fa-box"></i>
                        </span>
                    </div>
                    <p class="help is-danger" x-show="errors.name" x-text="errors.name"></p>
                </div>

                <!-- SKU -->
                <div class="field">
                    <label class="label">SKU <span class="has-text-danger">*</span></label>
                    <div class="control has-icons-left">
                        <input class="input" type="text" name="sku" placeholder="请输入SKU编号" required x-model="form.sku"
                            :class="{'is-danger': errors.sku}">
                        <span class="icon is-small is-left">
                            <i class="fas fa-barcode"></i>
                        </span>
                    </div>
                    <p class="help is-danger" x-show="errors.sku" x-text="errors.sku"></p>
                </div>
            </div>

            <div class="form-row">
                <!-- 分类 -->
                <div class="field">
                    <label class="label">分类 <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="category" required x-model="form.category">
                                <option value="">请选择分类</option>
                                <option value="电子产品">电子产品</option>
                                <option value="数码配件">数码配件</option>
                                <option value="办公用品">办公用品</option>
                                <option value="智能设备">智能设备</option>
                                <option value="电脑配件">电脑配件</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 价格 -->
                <div class="field">
                    <label class="label">价格 <span class="has-text-danger">*</span></label>
                    <div class="control has-icons-left">
                        <input class="input" type="number" name="price" placeholder="请输入价格" required step="0.01" min="0"
                            x-model="form.price" :class="{'is-danger': errors.price}">
                        <span class="icon is-small is-left">
                            <i class="fas fa-yuan-sign"></i>
                        </span>
                    </div>
                    <p class="help is-danger" x-show="errors.price" x-text="errors.price"></p>
                </div>
            </div>

            <div class="form-row">
                <!-- 库存 -->
                <div class="field">
                    <label class="label">库存 <span class="has-text-danger">*</span></label>
                    <div class="control has-icons-left">
                        <input class="input" type="number" name="stock" placeholder="请输入库存数量" required min="0"
                            x-model="form.stock" :class="{'is-danger': errors.stock}">
                        <span class="icon is-small is-left">
                            <i class="fas fa-warehouse"></i>
                        </span>
                    </div>
                    <p class="help is-danger" x-show="errors.stock" x-text="errors.stock"></p>
                </div>

                <!-- 状态 -->
                <div class="field">
                    <label class="label">状态 <span class="has-text-danger">*</span></label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="status" required x-model="form.status">
                                <option value="">请选择状态</option>
                                <option value="active">上架</option>
                                <option value="inactive">下架</option>
                                <option value="out_of_stock">缺货</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 描述 -->
            <div class="field">
                <label class="label">商品描述</label>
                <div class="control">
                    <textarea class="textarea" name="description" placeholder="请输入商品描述" rows="4"
                        x-model="form.description"></textarea>
                </div>
            </div>

            <!-- 提交按钮 -->
            <div class="field is-grouped is-grouped-right" style="margin-top: 2rem;">
                <div class="control">
                    <a href="/products" hx-get="/products" hx-target="#main-container" hx-swap="innerHTML"
                        hx-push-url="true" class="button is-light">
                        <span class="icon">
                            <i class="fas fa-times"></i>
                        </span>
                        <span>取消</span>
                    </a>
                </div>
                <div class="control">
                    <button type="submit" class="button is-primary" :class="{'is-loading': loading}"
                        :disabled="loading">
                        <span class="icon">
                            <i class="fas fa-save"></i>
                        </span>
                        <span>创建商品</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function productForm() {
        return {
            loading: false,
            errors: {},
            form: {
                name: '',
                sku: '',
                category: '',
                price: '',
                stock: '',
                status: 'active',
                description: ''
            },

            validateForm() {
                this.errors = {};
                let isValid = true;

                if (!this.form.name) {
                    this.errors.name = '商品名称不能为空';
                    isValid = false;
                }

                if (!this.form.sku) {
                    this.errors.sku = 'SKU不能为空';
                    isValid = false;
                }

                if (!this.form.price || parseFloat(this.form.price) < 0) {
                    this.errors.price = '请输入有效的价格';
                    isValid = false;
                }

                if (!this.form.stock || parseInt(this.form.stock) < 0) {
                    this.errors.stock = '请输入有效的库存数量';
                    isValid = false;
                }

                return isValid;
            },

            submitForm(event) {
                if (this.validateForm()) {
                    this.loading = true;
                    htmx.trigger(event.target, 'submit');
                }
            }
        };
    }
</script>