<!-- 商品列表页面 -->
<div class="space-y-6">
    <!-- 页面标题 - 使用 hx-swap-oob 更新顶部标题 -->
    <div id="page-title" hx-swap-oob="true">商品管理</div>

    <div class="card bg-base-100 shadow-sm border border-base-300">
        <div class="card-body">
            <!-- 页面头部 -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="card-title text-lg font-medium flex items-center gap-2">
                    <i class="fas fa-box text-info"></i>
                    商品列表
                </h2>
                <!-- 新增商品按钮 -->
                <a href="/products/new" class="btn btn-primary" hx-get="/products/new" hx-target="#main-container"
                    hx-swap="innerHTML" hx-push-url="true">
                    <i class="fas fa-plus"></i>
                    新增商品
                </a>
            </div>

            <!-- 搜索和筛选栏 -->
            <div class="flex flex-col lg:flex-row gap-4 mb-6">
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40"></i>
                    <input class="input input-bordered w-full pl-10" type="search" name="keyword"
                        placeholder="搜索商品名称、SKU..." value="{{.Query}}" hx-get="/products"
                        hx-trigger="keyup changed delay:500ms, search" hx-target="#products-container"
                        hx-swap="innerHTML" hx-select="#products-container > *" hx-include="[name='category']"
                        hx-indicator="#search-indicator">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 htmx-indicator" id="search-indicator">
                        <div class="loading loading-spinner loading-sm"></div>
                    </span>
                </div>

                <!-- 分类筛选 -->
                <div>
                    <select class="select select-bordered" name="category" hx-get="/products" hx-trigger="change"
                        hx-target="#products-container" hx-swap="innerHTML" hx-select="#products-container > *"
                        hx-include="[name='keyword']">
                        <option value="">全部分类</option>
                        <option value="电子产品" {{if eq .Category "电子产品" }}selected{{end}}>电子产品</option>
                        <option value="数码配件" {{if eq .Category "数码配件" }}selected{{end}}>数码配件</option>
                        <option value="办公用品" {{if eq .Category "办公用品" }}selected{{end}}>办公用品</option>
                        <option value="智能设备" {{if eq .Category "智能设备" }}selected{{end}}>智能设备</option>
                        <option value="电脑配件" {{if eq .Category "电脑配件" }}selected{{end}}>电脑配件</option>
                    </select>
                </div>
            </div>

            <!-- 商品网格容器 -->
            <div id="products-container">
                {{if .Products}}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {{range .Products}}
                    {{template "products/card.html" .}}
                    {{end}}
                </div>

                <!-- 分页 -->
                {{if gt .PageInfo.TotalPages 1}}
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-6">
                    <div class="text-sm text-base-content/60">
                        显示 {{.PageInfo.Page}} / {{.PageInfo.TotalPages}} 页，共 {{.PageInfo.Total}} 条记录
                    </div>
                    <div class="join">
                        {{if gt .PageInfo.Page 1}}
                        <a href="#"
                            hx-get="/products?page={{sub .PageInfo.Page 1}}&page_size={{.PageInfo.PageSize}}&keyword={{.Query}}&category={{.Category}}"
                            hx-target="#products-container" hx-swap="innerHTML" hx-select="#products-container > *"
                            class="join-item btn btn-sm">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        {{else}}
                        <button class="join-item btn btn-sm" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        {{end}}

                        {{range $i := iterate .PageInfo.TotalPages}}
                        {{if eq $i $.PageInfo.Page}}
                        <button class="join-item btn btn-sm btn-active">{{$i}}</button>
                        {{else if or (eq $i 1) (eq $i $.PageInfo.TotalPages) (and (ge $i (sub $.PageInfo.Page 2))
                        (le $i (add $.PageInfo.Page 2)))}}
                        <a href="#"
                            hx-get="/products?page={{$i}}&page_size={{$.PageInfo.PageSize}}&keyword={{$.Query}}&category={{$.Category}}"
                            hx-target="#products-container" hx-swap="innerHTML" hx-select="#products-container > *"
                            class="join-item btn btn-sm">
                            {{$i}}
                        </a>
                        {{else if or (eq $i 2) (eq $i (sub $.PageInfo.TotalPages 1))}}
                        <button class="join-item btn btn-sm" disabled>…</button>
                        {{end}}
                        {{end}}

                        {{if lt .PageInfo.Page .PageInfo.TotalPages}}
                        <a href="#"
                            hx-get="/products?page={{add .PageInfo.Page 1}}&page_size={{.PageInfo.PageSize}}&keyword={{.Query}}&category={{.Category}}"
                            hx-target="#products-container" hx-swap="innerHTML" hx-select="#products-container > *"
                            class="join-item btn btn-sm">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                        {{else}}
                        <button class="join-item btn btn-sm" disabled>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        {{end}}
                    </div>
                </div>
                {{end}}
                {{else}}
                <div class="text-center py-12">
                    <i class="fas fa-box-open text-6xl text-base-300 mb-4"></i>
                    <h3 class="text-lg font-medium mb-2">没有找到商品</h3>
                    <p class="text-base-content/60">尝试调整搜索条件或创建新商品</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>
</div>