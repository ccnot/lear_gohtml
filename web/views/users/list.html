<!-- 用户列表页面 -->
<div class="space-y-6">
    <!-- 页面标题 - 使用 hx-swap-oob 更新顶部标题 -->
    <div id="page-title" hx-swap-oob="true">用户列表</div>

    <!-- 面包屑导航 -->
    <div class="text-sm breadcrumbs">
        <ul>
            <li><a href="/dashboard" hx-get="/dashboard" hx-target="#main-container" hx-swap="innerHTML"
                   hx-push-url="true">首页</a></li>
            <li>用户管理</li>
            <li>用户列表</li>
        </ul>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-300">
        <div class="card-body">
            <!-- 页面头部 -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="card-title text-lg font-medium flex items-center gap-2">
                    <i class="fas fa-users text-primary"></i>
                    用户列表
                </h2>
                <!-- 新增用户按钮 -->
                <a href="/users/new" class="btn btn-primary" hx-get="/users/new" hx-target="#main-container"
                   hx-swap="innerHTML" hx-push-url="true">
                    <i class="fas fa-plus"></i>
                    新增用户
                </a>
            </div>

            <!-- 搜索和筛选栏 -->
            <div class="flex flex-col lg:flex-row gap-4 mb-6">
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40"></i>
                    <input class="input input-bordered w-full pl-10" type="search" name="keyword" placeholder="搜索用户名、邮箱或姓名..." value="{{.Query}}"
                           hx-get="/users" hx-trigger="keyup changed delay:500ms, search" hx-target="#user-table-container"
                           hx-swap="innerHTML" hx-select="#user-table-container > *" hx-include="[name='status']"
                           hx-indicator="#search-indicator">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 htmx-indicator" id="search-indicator">
                        <div class="loading loading-spinner loading-sm"></div>
                    </span>
                </div>

                <!-- 状态筛选 -->
                <div>
                    <select class="select select-bordered" name="status" hx-get="/users" hx-trigger="change"
                            hx-target="#user-table-container" hx-swap="innerHTML" hx-select="#user-table-container > *"
                            hx-include="[name='keyword']">
                        <option value="" {{if eq .Status "" }}selected{{end}}>全部状态</option>
                        <option value="active" {{if eq .Status "active" }}selected{{end}}>活跃</option>
                        <option value="inactive" {{if eq .Status "inactive" }}selected{{end}}>非活跃</option>
                    </select>
                </div>
            </div>

            <!-- 用户表格容器 -->
            <div id="user-table-container">
                {{if .Users}}
                <div class="overflow-x-auto">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>用户名</th>
                                <th>真实姓名</th>
                                <th>邮箱</th>
                                <th>电话</th>
                                <th>角色</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="user-table-body">
                            {{range .Users}}
                            {{template "users/row.html" .}}
                            {{end}}
                        </tbody>
                    </table>
                </div>

                <!-- 分页 -->
                {{$ctx := dict "BaseURL" "/users" "PageInfo" .PageInfo "TargetContainer" "user-table-container" "ExtraParams" (dict "keyword" .Query "status" .Status)}}
                {{template "components/pagination.html" $ctx}}
                {{else}}
                <div class="text-center py-12">
                    <i class="fas fa-users text-6xl text-base-300 mb-4"></i>
                    <h3 class="text-lg font-medium mb-2">没有找到用户</h3>
                    <p class="text-base-content/60">尝试调整搜索条件或创建新用户</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>
</div>