<!-- 用户编辑页面 -->
<div>
    <!-- 页面标题 -->
    <div id="page-title" hx-swap-oob="true">编辑用户</div>

    <!-- 面包屑 -->
    <ul class="uk-breadcrumb" style="margin-bottom: 24px;">
        <li><a href="/dashboard" hx-get="/dashboard" hx-target="#main-container" hx-swap="innerHTML"
                hx-push-url="true">首页</a></li>
        <li><span>用户管理</span></li>
        <li><a href="/users" hx-get="/users" hx-target="#main-container" hx-swap="innerHTML" hx-push-url="true">用户列表</a>
        </li>
        <li class="uk-disabled"><span>编辑用户</span></li>
    </ul>

    <!-- 表单卡片 -->
    <div class="content-card" style="max-width: 900px;">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-user-edit" style="color: var(--info-color);"></i>
                编辑用户信息
            </h3>
        </div>
        <div class="card-body">
            <!-- 错误提示框 -->
            {{if .Error}}
            <div class="uk-alert-danger" uk-alert>
                <a class="uk-alert-close" uk-close></a>
                <strong><i class="fas fa-exclamation-triangle"></i> 验证错误</strong>
                <p style="margin-top: 8px;">{{.Error}}</p>
            </div>
            {{end}}

            <form hx-put="/users/{{.User.ID}}" hx-target="#main-container" hx-swap="innerHTML"
                x-data="userForm(true, {{.User.ID}})" @submit="submitForm($event)" x-init="
                    {{if .FormData}}
                    form.email = '{{.FormData.Email}}';
                    form.realName = '{{.FormData.RealName}}';
                    form.phone = '{{.FormData.Phone}}';
                    form.role = '{{.FormData.Role}}';
                    form.status = '{{.FormData.Status}}';
                    {{else}}
                    form.email = '{{.User.Email}}';
                    form.realName = '{{.User.RealName}}';
                    form.phone = '{{.User.Phone}}';
                    form.role = '{{.User.Role}}';
                    form.status = '{{.User.Status}}';
                    {{end}}
                ">

                <div class="form-row">
                    <!-- 用户名（只读） -->
                    <div>
                        <label class="uk-form-label">用户名</label>
                        <div class="uk-form-controls uk-inline uk-width-1-1">
                            <span class="uk-form-icon" uk-icon="icon: user"></span>
                            <input class="uk-input" type="text" name="username" value="{{.User.Username}}" readonly>
                        </div>
                        <div class="uk-form-help">用户名创建后不可修改</div>
                    </div>

                    <!-- 邮箱 -->
                    <div>
                        <label class="uk-form-label">邮箱 <span class="required">*</span></label>
                        <div class="uk-form-controls uk-inline uk-width-1-1">
                            <span class="uk-form-icon" uk-icon="icon: mail"></span>
                            <input class="uk-input" type="email" name="email" placeholder="请输入邮箱"
                                value="{{.User.Email}}" required x-model="form.email"
                                :class="{'uk-form-danger': errors.email}">
                        </div>
                        <div class="uk-form-help uk-text-danger" x-show="errors.email" x-text="errors.email"></div>
                    </div>
                </div>

                <div class="form-row">
                    <!-- 真实姓名 -->
                    <div>
                        <label class="uk-form-label">真实姓名 <span class="required">*</span></label>
                        <div class="uk-form-controls uk-inline uk-width-1-1">
                            <span class="uk-form-icon" uk-icon="icon: happy"></span>
                            <input class="uk-input" type="text" name="real_name" placeholder="请输入真实姓名"
                                value="{{.User.RealName}}" required x-model="form.realName"
                                :class="{'uk-form-danger': errors.realName}">
                        </div>
                        <div class="uk-form-help uk-text-danger" x-show="errors.realName" x-text="errors.realName">
                        </div>
                    </div>

                    <!-- 电话 -->
                    <div>
                        <label class="uk-form-label">电话</label>
                        <div class="uk-form-controls uk-inline uk-width-1-1">
                            <span class="uk-form-icon" uk-icon="icon: receiver"></span>
                            <input class="uk-input" type="tel" name="phone" placeholder="请输入电话号码"
                                value="{{.User.Phone}}" x-model="form.phone" pattern="^1[3-9]\d{9}$">
                        </div>
                        <div class="uk-form-help">请输入11位手机号码</div>
                    </div>
                </div>

                <div class="form-row">
                    <!-- 角色 -->
                    <div>
                        <label class="uk-form-label">角色 <span class="required">*</span></label>
                        <div class="uk-form-controls">
                            <select class="uk-select" name="role" required x-model="form.role">
                                <option value="">请选择角色</option>
                                <option value="admin" {{if eq .User.Role "admin" }}selected{{end}}>管理员</option>
                                <option value="editor" {{if eq .User.Role "editor" }}selected{{end}}>编辑</option>
                                <option value="viewer" {{if eq .User.Role "viewer" }}selected{{end}}>访客</option>
                            </select>
                        </div>
                    </div>

                    <!-- 状态 -->
                    <div>
                        <label class="uk-form-label">状态 <span class="required">*</span></label>
                        <div class="uk-form-controls">
                            <select class="uk-select" name="status" required x-model="form.status">
                                <option value="">请选择状态</option>
                                <option value="active" {{if eq .User.Status "active" }}selected{{end}}>活跃</option>
                                <option value="inactive" {{if eq .User.Status "inactive" }}selected{{end}}>非活跃
                                </option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 用户信息 -->
                <div class="uk-alert-primary" uk-alert style="margin-top: 24px;">
                    <p><strong>创建时间：</strong>{{.User.CreatedAt.Format "2006-01-02 15:04:05"}}</p>
                    <p><strong>更新时间：</strong>{{.User.UpdatedAt.Format "2006-01-02 15:04:05"}}</p>
                </div>

                <!-- 提交按钮 -->
                <div class="uk-flex uk-flex-right" style="gap: 12px; margin-top: 24px;">
                    <a href="/users" hx-get="/users" hx-target="#main-container" hx-swap="innerHTML" hx-push-url="true"
                        class="uk-button uk-button-default">
                        <i class="fas fa-times"></i>
                        <span>取消</span>
                    </a>
                    <button type="submit" class="uk-button uk-button-primary" :disabled="loading">
                        <span x-show="loading" uk-spinner="ratio: 0.5"></span>
                        <i class="fas fa-save" x-show="!loading"></i>
                        <span>更新用户</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>