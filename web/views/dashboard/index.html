<!-- 仪表盘主页 -->
<div>
    <!-- 页面标题 - 使用 hx-swap-oob 更新顶部标题 -->
    <div id="page-title" hx-swap-oob="true">仪表盘</div>

    <!-- 统计卡片 - 每 30 秒自动刷新 -->
    <div id="stats-container" hx-get="/dashboard/stats" hx-trigger="every 30s" hx-swap="innerHTML">
        {{template "dashboard/stats.html" .Stats}}
    </div>

    <!-- 内容区域 -->
    <div class="columns">
        <!-- 最近订单 -->
        <div class="column is-8">
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-shopping-cart has-text-info"></i>
                        最近订单
                    </h3>
                    <a href="/orders" class="button is-small is-info is-light" hx-get="/orders"
                        hx-target="#main-container" hx-swap="innerHTML" hx-push-url="true">
                        查看全部
                    </a>
                </div>
                <div class="card-body">
                    {{if .RecentOrders}}
                    <table class="table is-fullwidth is-hoverable">
                        <thead>
                            <tr>
                                <th>订单号</th>
                                <th>客户</th>
                                <th>金额</th>
                                <th>状态</th>
                                <th>创建时间</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .RecentOrders}}
                            <tr>
                                <td><strong>{{.OrderNo}}</strong></td>
                                <td>{{.CustomerName}}</td>
                                <td class="has-text-weight-semibold">¥{{printf "%.2f" .TotalAmount}}</td>
                                <td>
                                    {{if eq .Status "pending"}}
                                    <span class="badge is-warning">待处理</span>
                                    {{else if eq .Status "paid"}}
                                    <span class="badge is-info">已支付</span>
                                    {{else if eq .Status "shipped"}}
                                    <span class="badge is-primary">已发货</span>
                                    {{else if eq .Status "completed"}}
                                    <span class="badge is-success">已完成</span>
                                    {{end}}
                                </td>
                                <td>{{.CreatedAt.Format "2006-01-02 15:04"}}</td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                    {{else}}
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
                        <div class="empty-state-text">暂无订单数据</div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>

        <!-- 侧边栏信息 -->
        <div class="column is-4">
            <!-- 最近用户 -->
            <div class="content-card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-users has-text-success"></i>
                        最近注册
                    </h3>
                </div>
                <div class="card-body">
                    {{if .RecentUsers}}
                    {{range .RecentUsers}}
                    <div
                        style="display: flex; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #f5f5f5;">
                        <div
                            style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 1rem;">
                            {{substr .RealName 0 1}}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">{{.RealName}}</div>
                            <div style="font-size: 0.875rem; color: #7a7a7a;">{{.Email}}</div>
                        </div>
                        <div>
                            {{if eq .Role "admin"}}
                            <span class="tag is-danger is-light">管理员</span>
                            {{else if eq .Role "editor"}}
                            <span class="tag is-info is-light">编辑</span>
                            {{else}}
                            <span class="tag is-light">访客</span>
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                    {{else}}
                    <div class="empty-state">
                        <p class="has-text-grey">暂无用户数据</p>
                    </div>
                    {{end}}
                </div>
            </div>

            <!-- 热门商品 -->
            <div class="content-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-fire has-text-danger"></i>
                        热门商品
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TopProducts}}
                    {{range .TopProducts}}
                    <div
                        style="display: flex; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #f5f5f5;">
                        <div
                            style="width: 50px; height: 50px; background: #f5f5f5; border-radius: 4px; margin-right: 1rem; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-box has-text-grey-light" style="font-size: 1.5rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">{{.Name}}</div>
                            <div style="font-size: 0.875rem; color: #7a7a7a;">库存: {{.Stock}}</div>
                        </div>
                        <div class="has-text-primary has-text-weight-bold">
                            ¥{{printf "%.2f" .Price}}
                        </div>
                    </div>
                    {{end}}
                    {{else}}
                    <div class="empty-state">
                        <p class="has-text-grey">暂无商品数据</p>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>
</div>